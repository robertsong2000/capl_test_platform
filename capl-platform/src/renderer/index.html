<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAPL测试平台</title>
    <link rel="stylesheet" href="../../node_modules/element-ui/lib/theme-chalk/index.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }
        
        #app {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 20px;
        }
        
        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .sidebar {
            width: 250px;
            background-color: #34495e;
            color: white;
            padding: 20px;
            overflow-y: auto;
        }
        
        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: white;
        }
        
        .project-item {
            padding: 10px;
            margin: 5px 0;
            background-color: #2c3e50;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .project-item:hover {
            background-color: #3498db;
        }
        
        .project-item.active {
            background-color: #3498db;
        }
        
        .test-case-item {
            padding: 8px;
            margin: 3px 0;
            background-color: #ecf0f1;
            border-radius: 3px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .test-case-item:hover {
            background-color: #bdc3c7;
        }
        
        .test-case-item.active {
            background-color: #3498db;
            color: white;
        }
        
        .editor-container {
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .button-group {
            margin: 10px 0;
        }
        
        .step-item {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .step-number {
            background-color: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .empty-state {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            color: #dee2e6;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>CAPL测试平台</h1>
            <div>
                <el-button type="primary" size="small" @click="showNewProjectDialog = true">
                    新建项目
                </el-button>
                <el-button type="info" size="small" @click="showSettingsDialog = true">
                    设置
                </el-button>
            </div>
        </div>
        
        <div class="main-container">
            <div class="sidebar">
                <h3>项目列表</h3>
                <div v-for="project in projects" 
                     :key="project.id"
                     :class="['project-item', { active: currentProject && currentProject.id === project.id }]"
                     @click="selectProject(project)">
                    {{ project.name }}
                </div>
                
                <div v-if="currentProject" style="margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3>测试用例</h3>
                        <el-button type="primary" size="mini" @click="showNewTestCaseDialog = true">
                            新建
                        </el-button>
                    </div>
                    <div v-for="testCase in testCases" 
                         :key="testCase.id"
                         :class="['test-case-item', { active: currentTestCase && currentTestCase.id === testCase.id }]"
                         @click="selectTestCase(testCase)">
                        {{ testCase.name }}
                    </div>
                </div>
            </div>
            
            <div class="content">
                <!-- 项目详情 -->
                <div v-if="currentProject && !currentTestCase">
                    <h2>{{ currentProject.name }}</h2>
                    <p>{{ currentProject.description }}</p>
                    
                    <div class="button-group">
                        <el-button type="primary" @click="showNewTestCaseDialog = true">
                            新建测试用例
                        </el-button>
                        <el-button @click="editProject">
                            编辑项目
                        </el-button>
                        <el-button type="danger" @click="deleteProject">
                            删除项目
                        </el-button>
                    </div>
                    
                    <el-table :data="testCases" style="width: 100%">
                        <el-table-column prop="name" label="用例名称"></el-table-column>
                        <el-table-column prop="description" label="描述"></el-table-column>
                        <el-table-column prop="priority" label="优先级"></el-table-column>
                        <el-table-column prop="status" label="状态"></el-table-column>
                        <el-table-column label="操作" width="200">
                            <template slot-scope="scope">
                                <el-button size="mini" @click="selectTestCase(scope.row)">查看</el-button>
                                <el-button size="mini" type="danger" @click="deleteTestCase(scope.row)">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
                
                <!-- 测试用例详情 -->
                <div v-if="currentTestCase">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>{{ currentTestCase.name }}</h2>
                        <div>
                            <el-button @click="backToProject">返回项目</el-button>
                            <el-button type="primary" @click="editTestCase">编辑</el-button>
                            <el-button type="danger" @click="deleteTestCase">删除</el-button>
                        </div>
                    </div>
                    
                    <el-form label-width="100px">
                        <el-form-item label="描述:">
                            <span>{{ currentTestCase.description }}</span>
                        </el-form-item>
                        <el-form-item label="优先级:">
                            <el-tag>{{ currentTestCase.priority }}</el-tag>
                        </el-form-item>
                        <el-form-item label="状态:">
                            <el-tag :type="currentTestCase.status === 'ACTIVE' ? 'success' : 'info'">
                                {{ currentTestCase.status }}
                            </el-tag>
                        </el-form-item>
                    </el-form>
                    
                    <div style="margin: 20px 0;">
                        <h3>测试步骤</h3>
                        <div class="button-group">
                            <el-button type="primary" @click="addTestStep">添加步骤</el-button>
                            <el-button @click="runTestCase" type="success">执行测试</el-button>
                        </div>
                        
                        <div v-if="testSteps.length === 0" class="empty-state">
                            <i class="el-icon-document"></i>
                            <p>暂无测试步骤</p>
                            <el-button type="primary" @click="addTestStep">添加第一个步骤</el-button>
                        </div>
                        
                        <div v-for="(step, index) in testSteps" :key="step.id" class="step-item">
                            <div class="step-header">
                                <span class="step-number">步骤 {{ step.step_number }}</span>
                                <div>
                                    <el-button size="mini" @click="editTestStep(step)">编辑</el-button>
                                    <el-button size="mini" type="danger" @click="deleteTestStep(step)">删除</el-button>
                                </div>
                            </div>
                            <div>
                                <strong>操作描述:</strong> {{ step.action_description }}
                            </div>
                            <div v-if="step.expected_result" style="margin-top: 10px;">
                                <strong>预期结果:</strong> {{ step.expected_result }}
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <h3>CAPL脚本</h3>
                        <div class="button-group">
                            <el-button type="primary" @click="showCAPLEditor = true">编辑脚本</el-button>
                            <el-button @click="saveCAPLScript">保存脚本</el-button>
                        </div>
                        <div class="editor-container" ref="caplEditor"></div>
                    </div>
                </div>
                
                <!-- 空状态 -->
                <div v-if="!currentProject" class="empty-state">
                    <i class="el-icon-folder-opened"></i>
                    <h3>欢迎使用CAPL测试平台</h3>
                    <p>请选择一个项目开始工作，或创建新项目</p>
                    <el-button type="primary" @click="showNewProjectDialog = true">创建新项目</el-button>
                </div>
            </div>
        </div>
        
        <!-- 新建项目对话框 -->
        <el-dialog title="新建项目" :visible.sync="showNewProjectDialog" width="500px">
            <el-form :model="newProject" label-width="80px">
                <el-form-item label="项目名称">
                    <el-input v-model="newProject.name"></el-input>
                </el-form-item>
                <el-form-item label="描述">
                    <el-input type="textarea" v-model="newProject.description"></el-input>
                </el-form-item>
            </el-form>
            <span slot="footer" class="dialog-footer">
                <el-button @click="showNewProjectDialog = false">取消</el-button>
                <el-button type="primary" @click="createProject">确定</el-button>
            </span>
        </el-dialog>
        
        <!-- 新建测试用例对话框 -->
        <el-dialog title="新建测试用例" :visible.sync="showNewTestCaseDialog" width="500px">
            <el-form :model="newTestCase" label-width="80px">
                <el-form-item label="用例名称">
                    <el-input v-model="newTestCase.name"></el-input>
                </el-form-item>
                <el-form-item label="描述">
                    <el-input type="textarea" v-model="newTestCase.description"></el-input>
                </el-form-item>
                <el-form-item label="优先级">
                    <el-select v-model="newTestCase.priority">
                        <el-option label="高" value="HIGH"></el-option>
                        <el-option label="中" value="MEDIUM"></el-option>
                        <el-option label="低" value="LOW"></el-option>
                    </el-select>
                </el-form-item>
            </el-form>
            <span slot="footer" class="dialog-footer">
                <el-button @click="showNewTestCaseDialog = false">取消</el-button>
                <el-button type="primary" @click="createTestCase">确定</el-button>
            </span>
        </el-dialog>
        
        <!-- 设置对话框 -->
        <el-dialog title="系统设置" :visible.sync="showSettingsDialog" width="600px">
            <el-form label-width="120px">
                <el-form-item label="CANoe路径">
                    <el-input v-model="settings.canoe_path" placeholder="请选择CANoe安装路径">
                        <el-button slot="append" @click="selectCANoePath">浏览</el-button>
                    </el-input>
                </el-form-item>
                <el-form-item label="默认优先级">
                    <el-select v-model="settings.default_priority">
                        <el-option label="高" value="HIGH"></el-option>
                        <el-option label="中" value="MEDIUM"></el-option>
                        <el-option label="低" value="LOW"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="自动备份">
                    <el-switch v-model="settings.auto_backup"></el-switch>
                </el-form-item>
            </el-form>
            <span slot="footer" class="dialog-footer">
                <el-button @click="showSettingsDialog = false">取消</el-button>
                <el-button type="primary" @click="saveSettings">保存</el-button>
            </span>
        </el-dialog>
    </div>

    <script src="../../node_modules/vue/dist/vue.js"></script>
    <script src="../../node_modules/element-ui/lib/index.js"></script>
    <script src="../../node_modules/monaco-editor/min/vs/loader.js"></script>
    <script src="renderer.js"></script>
</body>
</html>